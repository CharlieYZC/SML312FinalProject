# SML312FinalProject

Below is an overview of the paper; the paper can be found along with the codes and sample datasets.

## Overview
The project aims to explore the prediction of price movements in index-tracking ETFs, particularly the Invesco QQQ Trust, which tracks the NASDAQ index. Predicting the price of financial assets is a critical task for investors and traders for risk management and portfolio optimization. The task is especially challenging in the short term, as price movements can be volatile and influenced by numerous unpredictable factors. Machine learning has increasingly been utilized to tackle this issue, using past data on technical indicators, market sentiment, and macroeconomic factors. This project attempts to address the question of whether it’s possible to predict the price or price movements of index-tracking ETFs, and whether an optimal machine learning model can be developed for this purpose. Additionally, it investigates whether the developed model could be used for intra-day trading strategies that might outperform the market. The research questions addressed include identifying the most influential factors, determining the most appropriate model, and evaluating the model based on a suitable metric, such as accuracy or return.

The research focuses on using the last 30 trading days of data, considering macroeconomic indicators (e.g., currency exchange rates and treasury bond data), technical indicators (e.g., moving averages), and volatility indices (e.g., VIX, VIN). By selecting features from this wide array of data, the model is designed to predict the price movement or price level of the ETF in the short term. The model’s goal is not only to predict accurately but also to provide a foundation for building trading strategies. The project provides a comprehensive view of machine learning methods, evaluation techniques, and real-world applications through backtesting to validate the theoretical models developed. The main methodologies used include feature engineering, model training with cross-validation, and evaluating the performance through backtesting, which involves testing the model on unseen data to check its ability to make real predictions.

## Related Work
The first study, which utilizes advanced methods such as Generative Adversarial Networks (GAN), Long Short-Term Memory networks (LSTM), and Reinforcement Learning (RL), was a foundational influence. This research demonstrated the power of using machine learning for financial predictions, particularly for stocks, which are more volatile than ETFs. While the original study used complex models and a large number of features to predict the stock price, this paper simplifies the task by focusing on ETFs. ETFs typically have lower volatility, making them potentially easier to predict due to the reduced noise and randomness in their price movements. The use of simpler models is a deliberate choice, aiming to predict the movement of a less volatile asset, the QQQ ETF, using macroeconomic and technical indicators.

The second related study examined algorithmic trading systems designed to predict market trends using financial indices. It highlighted the usefulness of volatility indices such as VIX and VIN in predicting broader market movements. These indices serve as key features in the paper’s model, aligning with the goal of integrating market sentiment into ETF price predictions. 

The third study focused on predicting the direction of ETF prices (up or down) using models like deep neural networks, random forests, and support vector machines (SVMs). This work inspired the decision to incorporate multiple ETFs as features in the model, broadening the data input and increasing the chance of identifying relevant market signals.

## Data
The dataset used in this project includes a wide variety of market and macroeconomic data sources (all from Wharton Research Data Services, WRDS). The market sentiment data includes volatility indices such as the CBOE S&P500 Volatility Index (VIX), the CBOE NASDAQ Volatility Index (VIN), and the CBOE DJIA Volatility Index (VID), which reflect the overall market sentiment and investor expectations. These indices serve as indicators of market uncertainty and are used as key features in the machine learning models. The ETF data includes the price and volume of ETFs such as QQQ, SPY (S&P 500), and GLD (Gold), which are used to track the performance of different asset classes. Additionally, the dataset incorporates exchange rates for major currencies (EUR, JPY, GBP, CHF, and CNY), which provide important macroeconomic context that could influence ETF prices. The inclusion of US Treasury bond data adds another layer of economic insight, helping to capture movements in interest rates and inflation expectations.

The data is cleaned by removing invalid entries and aligning dates across all datasets to ensure consistency. This process results in a clean dataset that can be used for model training. For each trading day, the dataset uses the past 30 trading days' worth of data (from day -1 to day -30) as input features to predict the price or price movement for the next trading day. To evaluate the model’s performance, the data is split into three subsets: 80% for training, 10% for cross-validation, and 10% for testing. The training set spans from 2005 to 2020, the cross-validation set covers 2020 to 2022, and the test set runs from 2022 to 2023.

## Modeling & Analysis
The process of modeling begins with selecting the most suitable output variable for predicting ETF price movements from the three possibilities: the next day’s closing price, the price movement (up or down), and the percent change in price. Price movement (1 for up and 0 for down), which is a more common approach in the literature, is selected to be the output variable for this project. The goal is to predict whether the ETF will increase or decrease in price on the following trading day, which directly relates to developing a practical trading strategy. Several machine learning models are tested, including logistic regression, random forest, SVM, and neural networks, to determine which provides the best prediction accuracy for the price movement.

The modeling and evaluation process involves training models on historical data and assessing their performance primarily using accuracy, but also considering precision, recall, and other metrics. Precision and recall are important because they assess the effectiveness of the model in predicting upward price movements (precision) and capturing all instances of upward price movement (recall). The project also emphasizes the importance of feature engineering, which involves selecting the most relevant indicators to improve model performance. Moving averages and percent changes of ETFs are included as features based on insights from related work. The models are trained using the training set, and their performance is evaluated on the cross-validation set, with backtesting used to evaluate the potential trading strategies that could be derived from the model’s predictions.

## Results & Discussion
The results show that, without feature selection, several models perform similarly poorly, with accuracy rates generally below 50%, indicating that many of the models are no better than random guessing. Among the models tested, Naive Bayes performs the best, with an accuracy of 55.37%, followed by logistic regression and quadratic discriminant analysis (QDA). This suggests that the task of predicting short-term price movements of an ETF like QQQ is extremely difficult, and none of the models reliably outperforms a trivial model that always predicts the most common price movement.

Feature selection techniques such as random forest feature importance, PCA, and Lasso regularization were applied to improve model performance. While feature selection did not lead to significant improvements in many cases, it helped highlight the importance of certain features, particularly the percent changes and volume of other ETFs and volatility indices. After feature selection, the decision tree and QDA models performed better, with decision trees achieving higher precision and recall. Backtesting of the models' trading strategies on the test set revealed that the QDA model outperforms both of the trivial strategies by a great amount (the return for the QDA model is 40.94%, while the returns of trivial strategies are 12.58% and 27.62 %), which suggests a trading strategy based on the QDA model is promising. It seems that the QDA model is able to better capture the alpha in the test set, even though it doesn't have an extrodinarily high accuracy rate for the test set. It does, however, have a high recall rate of 0.7276, which suggests that it might be more important that the model is able to capture the upward movements of the ETF than to avoid adverse conditions. At the same time, some alpha's were lost with the naive bayes and decision tree models with the test set, probably for analogous reasons. Therefore, the actual percent change might be important for trading strategy, which is something to consider in the future.
